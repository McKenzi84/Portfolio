---
import { getCollection } from "astro:content";
import BaseLayoutNew from "../../layouts/BaseLayoutNew.astro";
import PostCard from "../../components/post/PostCard.astro";
import Pagination from "../../components/Pagination.astro";
import { type Page } from "astro";
import { getPublishedPosts, sortPostsByDate } from "../../utils/filterts";
import { POSTS_PER_PAGE } from "../../consts";

import type { GetStaticPathsOptions } from "astro";

interface Props {
  page: Page;
}

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const posts = await getCollection("blog");
  const published = getPublishedPosts(posts);
  const sortedByDate = sortPostsByDate(published);

  return paginate(sortedByDate, { pageSize: POSTS_PER_PAGE });
}

const { page } = Astro.props;
---
<!-- // This layout is used for rendering paginated list of blog posts.// -->
<BaseLayoutNew title="Resources" description="- Browse every blog post I've written.">
  <h1 class="text-2xl font-semibold mb-9">Resources</h1>
  <section>
    {page.data.map((post: any) => <PostCard post={post} />)}
  </section>
  <Pagination currentPage={page.currentPage} totalPages={page.lastPage} path="posts/" />
</BaseLayoutNew>
